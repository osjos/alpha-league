<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Alpha League – Firebase Client Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>body{font-family:system-ui,Arial;margin:2rem;max-width:720px}</style>
  </head>
  <body>
    <h1>Firebase Web SDK smoke test</h1>
    <p>Auth user: <code id="user">—</code></p>
    <p>healthchecks/cli doc: <code id="doc">loading…</code></p>
    <button id="google">Sign in with Google</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import { getAuth, signInAnonymously, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

      // 🔁 Paste your config from Firebase Console here:
      const firebaseConfig = {
        apiKey: ""AIzaSyBB2XHlQZjwU5B8L0RX8jLecgjnjq10QCU",
        authDomain: "alpha-league-4370d.firebaseapp.com",
        projectId: "alpha-league-4370d",
        storageBucket: "alpha-league-4370d.firebasestorage.app",
        messagingSenderId: "109862722648",
        appId: "1:109862722648:web:a2a9559efe7df1d99fbe2d"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Optional: Google sign-in button
      document.getElementById('google').onclick = async () => {
        try {
          await signInWithPopup(auth, new GoogleAuthProvider());
        } catch (e) { console.error(e); alert(e.message); }
      };

      // Anonymous sign-in for quick test
      signInAnonymously(auth).catch(console.error);

      onAuthStateChanged(auth, async (user) => {
        document.getElementById('user').textContent = user ? user.uid : 'signed out';

        // Write a client health doc
        await setDoc(doc(db, 'clientHealth', 'web'), {
          ok: true,
          when: serverTimestamp(),
          uid: user ? user.uid : null
        });

        // Read the server-side doc we created earlier in Step 5
        const snap = await getDoc(doc(db, 'healthchecks', 'cli'));
        document.getElementById('doc').textContent = snap.exists()
          ? JSON.stringify(snap.data())
          : 'no doc found';
      });
    </script>
  </body>
</html>